<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Taste In Movies</title>

    <!-- bootstrap-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
        integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- jQuery library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- all CSS properties here <https://developer.mozilla.org/en-US/docs/Web/CSS/Reference> -->
    <!-- Link to Moment.js -->
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-app.js"></script>


</head>

<body>

    <div class="container">

        <br>
        <!-- Jumbotron -->
        <div class="jumbotron">
            <h1 class="text-center">Taste in Movies</h1>
        </div>
        <div class="row">

            <!-- Sign-Up Card-->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        What movie will you be seeing tonight?
                    </div>
                    <div class="card-body">

                        <!-- Sign-up Form (note the various input "types")-->
                        <form role="form">
                            <div class="form-group">
                                <label for="name-input">Movie Title:</label>
                                <input class="form-control" id="title-input" type="text">
                                <button class="btn btn-default" id="add-user" type="submit">Submit</button>
                            </div>

                            <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-auth.js"></script>
                            <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-firestore.js"></script>
                            <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>
                            <script type="text/javascript">

                                // Your web app's Firebase configuration
                                var firebaseConfig = {
                                    apiKey: "AIzaSyBacTRmU5vpq0G3QHqJ6yRS1MBjDKgmcW4",
                                    authDomain: "clrproject.firebaseapp.com",
                                    databaseURL: "https://clrproject.firebaseio.com",
                                    projectId: "clrproject",
                                    storageBucket: "clrproject.appspot.com",
                                    messagingSenderId: "561191338086",
                                    appId: "1:561191338086:web:e03f2b1ea925491748ada7"
                                };
                                // Initialize Firebase
                                firebase.initializeApp(firebaseConfig);

                                // Create a variable to reference the database
                                var database = firebase.database();

                                // Initial Values I don't think I need these
                                // var selectedTitle = 0;
                                // var selectedGenre = "No one :-(";
                                // var selectedMetascore = 0;

                                // --------------------------------------------------------------

                                // In the initial load and subsequent value changes, get a snapshot of the stored data.
                                // This function allows you to update your page in real-time when the firebase database changes.
                                // database.ref().on("value", function (snapshot) {

                                // If Firebase has a Genre or Metascore stored, update our client-side variables
                                // if (snapshot.child(Genre).exists() && snapshot.child(Metascore).exists()) {
                                // Set the variables for Genre and Metascore equal to the stored values.
                                // highBidder = snapshot.val().highBidder;
                                // highPrice = parseInt(snapshot.val().highPrice);
                                // }

                                // // If Firebase does not have highPrice and highBidder values stored, they remain the same as the
                                // // values we set when we initialized the variables.
                                // // In either case, we want to log the values to console and display them on the page.
                                // console.log(highBidder);
                                // console.log(highPrice);
                                // $("#highest-bidder").text(highBidder);
                                // $("#highest-price").text(highPrice);

                                // // If any errors are experienced, log them to console.
                                // }
                                //  function (errorObject) {
                                // console.log("The read failed: " + errorObject.code);
                                // });

                                $("#add-user").on("click", function () {
                                    var searchTerm = $("#searchTerm-input").val().trim();
                                    event.preventDefault();
                                    console.log(searchTerm);

                                    // The search OMDB function takes a movie, searches the omdb api for it, and then passes the data to DiningSearch
                                    var searchOMDB = function (searchTerm) {
                                        var queryURL = "https://www.omdbapi.com/?t=" + searchTerm + "&apikey=9078b5fd";
                                        $.ajax({
                                            url: queryURL,
                                            method: "GET"
                                        }).then(function (response) {
                                            // TitleSearch(response);  this doesn't work yet
                                            console.log(response);
                                            var title = response.title;
                                            var genre = response.Genre;
                                            var metascore = response.Metascore;
                                            console.log(title);
                                            console.log(genre);
                                            console.log(metascore);


                                            database.ref().set({
                                                title,
                                                genre,
                                                metascore,
                                            });
                                        });
                                    };


                                    // //This is where we will figure out how to send the genre and metascore to a middle ground that finds the appropriate restaurant
                                    // var TitleSearch = function (data) {
                                    //     var genre = $(data.Genre);
                                    //     var metascore = $(data.Metascore);
                                    //     console.log(genre);
                                    //     console.log(metascore);

                                    // };
                                    // Search the OMDB API for the users movie genre and metascore
                                    searchOMDB(title);
                                });




                                // This "document.ready" code isn't necessary in this example... but is useful to become familiar with.
                                // "document.ready" makes sure that our JavaScript doesn't get run until the HTML document is finished loading.
                                // $(document).ready(function () {

                                //     // Here we use jQuery to select the header with "click-me" as its ID.
                                //     // Notice I have the #click-me, click, and then the function
                                //     // So $("#id|.class|element").on("action", function(){});
                                //     // And so whenever it is clicked...


                                // });

                            </script>

</body>

</html>